local success
mkdir $TMP_DIR/${SOURCE_DIRECTORY/$BUILD_DIRECTORY\//}       &&
cd $TMP_DIR                                                  &&
cd ${SOURCE_DIRECTORY/$BUILD_DIRECTORY\//}                   &&
for module in vegastrike data4.x;
do
	if [[ $VEGASTRIKE_DEVEL == "y" ]]; then
		local sourcefile=$SPELL-svn-$module.tar
	else
		local sourcefile=$SPELL-$VERSION-$module.tar
	fi &&

	if [[ $FORCE_DOWNLOAD ]]; then
		rm -f $SOURCE_CACHE/$sourcefile
	fi &&

	if [[ -f $SOURCE_CACHE/$sourcefile ]]; then
		message "${MESSAGE_COLOR}extracting old tarball in $TMP_DIR${DEFAULT_COLOR}" &&
		tar -xf $SOURCE_CACHE/$sourcefile                            &&
		cd $module                                                   &&
		message "${MESSAGE_COLOR}running svn update${DEFAULT_COLOR}" &&
		svn up || return 1
	else
		message "${MESSAGE_COLOR}creating new tarball${DEFAULT_COLOR}" &&
		message "${MESSAGE_COLOR}running svn checkout for module $module${DEFAULT_COLOR}" &&
		if [[ $VEGASTRIKE_DEVEL == "y" ]]; then
			svn co $VEGASTRIKE_SVN/trunk/$module $module ||
			return 1
		else
			svn co $VEGASTRIKE_SVN/tags/vegastrike_$VERSION/$module || 
			return 1
		fi
	fi &&
	message "${MESSAGE_COLOR}creating source tarball $sourcefile for module $module${DEFAULT_COLOR}" &&
	cd $TMP_DIR/${SOURCE_DIRECTORY/$BUILD_DIRECTORY\//}          &&
	tar -cf $sourcefile $module                                  &&
	mv $sourcefile $SOURCE_CACHE                                 &&
	success="Yeah!"
done                 &&
if [[ -z $success ]] ; then
    return 1
else
    return 0
fi
